create database tourenplaner;
use tourenplaner;

CREATE TABLE Request (
  id              INT           NOT NULL AUTO_INCREMENT,
  UserID          INT           NOT NULL REFERENCES user (id),
  JSONRequest     LONGBLOB,
  JSONResponse    LONGBLOB               DEFAULT NULL,
  PendingFlag     BOOL          NOT NULL DEFAULT 1,
  Costs           INT                    DEFAULT NULL,
  PaidFlag        BOOL          NOT NULL DEFAULT 0,
  RequestDate     DATETIME      NOT NULL,
  FinishedDate    DATETIME               DEFAULT NULL,
  CPUTime         BIGINT                 DEFAULT NULL,
  FailedFlag      BOOL          NOT NULL DEFAULT 0,
  FailDescription VARCHAR(5000)          DEFAULT NULL,
  PRIMARY KEY (ID),
  FOREIGN KEY (UserID) REFERENCES user (id)
);

CREATE TABLE User (
  id                INT           NOT NULL AUTO_INCREMENT,
  Email             VARCHAR(500)  NOT NULL,
  Passwordhash      VARCHAR(64)   NOT NULL,
  Salt              VARCHAR(64)   NOT NULL,
  AdminFlag         BOOL          NOT NULL DEFAULT 0,
  Status            ENUM ('NeedsVerification', 
                          'VerificationFailed', 
                          'Verified', 
                          'Delete') 
                                  NOT NULL DEFAULT 'NeedsVerification',
  FirstName         VARCHAR(100)  NOT NULL,
  LastName          VARCHAR(100)  NOT NULL,
  Address           VARCHAR(1000) NOT NULL,
  RegistrationDate  DATETIME      NOT NULL,
  VerifiedDate      DATETIME               DEFAULT NULL,
  DeleteRequestDate DATETIME               DEFAULT NULL,
  PRIMARY KEY (ID),
  UNIQUE KEY (Email)
);

INSERT INTO User (Email, Passwordhash, Salt, AdminFlag, Status, 
  FirstName, LastName, Address, RegistrationDate, VerifiedDate) 
  VALUES('root@tourenplaner', 'rootpwhash', 'rootsalt', '1', 'Verified', 
    'ro', 'ot', 'localhost', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);
