create database tourenplaner;
use tourenplaner;

CREATE TABLE Requests (
  id              INT           NOT NULL AUTO_INCREMENT,
  UserID          INT           NOT NULL REFERENCES Users (id),
  JSONRequest     LONGBLOB,
  JSONResponse    LONGBLOB               DEFAULT NULL,
  PendingFlag     BOOL          NOT NULL DEFAULT 1,
  Costs           INT           NOT NULL DEFAULT 0,
  PaidFlag        BOOL          NOT NULL DEFAULT 0,
  RequestDate     DATETIME      NOT NULL,
  FinishedDate    DATETIME               DEFAULT NULL,
  CPUTime         BIGINT        NOT NULL DEFAULT 0,
  FailedFlag      BOOL          NOT NULL DEFAULT 0,
  FailDescription TEXT                   DEFAULT NULL,
  PRIMARY KEY (ID),
  FOREIGN KEY (UserID) REFERENCES Users (id)
);

CREATE TABLE Users (
  id                INT           NOT NULL AUTO_INCREMENT,
  Email             TEXT          NOT NULL,
  Passwordhash      TEXT          NOT NULL,
  Salt              TEXT          NOT NULL,
  AdminFlag         BOOL          NOT NULL DEFAULT 0,
  Status            ENUM ('NeedsVerification', 
                          'VerificationFailed', 
                          'Verified', 
                          'Delete') 
                                  NOT NULL DEFAULT 'NeedsVerification',
  FirstName         TEXT          NOT NULL,
  LastName          TEXT          NOT NULL,
  Address           TEXT          NOT NULL,
  RegistrationDate  DATETIME      NOT NULL,
  VerifiedDate      DATETIME               DEFAULT NULL,
  DeleteRequestDate DATETIME               DEFAULT NULL,
  PRIMARY KEY (ID),
  UNIQUE (Email(256))
);

INSERT INTO Users (Email, Passwordhash, Salt, AdminFlag, Status, 
  FirstName, LastName, Address, RegistrationDate, VerifiedDate) 
  VALUES('root@tourenplaner', 'rootpwhash', 'rootsalt', '1', 'Verified', 
    'ro', 'ot', 'localhost', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);
